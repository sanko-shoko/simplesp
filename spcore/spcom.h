//--------------------------------------------------------------------------------
// Copyright (c) 2017-2019, sanko-shoko. All rights reserved.
//--------------------------------------------------------------------------------

#ifndef __SP_COM_H__
#define __SP_COM_H__


//--------------------------------------------------------------------------------
// system
//--------------------------------------------------------------------------------

#ifndef SP_USE_OMP
#define SP_USE_OMP 1
#endif

#ifndef SP_USE_ASSERT
#define SP_USE_ASSERT 1
#endif

#ifndef SP_USE_WRAPPER
#define SP_USE_WRAPPER 1
#endif

#ifndef SP_USE_CONSOLE
#define SP_USE_CONSOLE 1
#endif

#ifndef SP_USE_DEBUG
#define SP_USE_DEBUG 0
#endif


//--------------------------------------------------------------------------------
// call
//--------------------------------------------------------------------------------

// cpu function
#ifndef SP_CPUFUNC
#define SP_CPUFUNC static
#endif

// cpu/gpu function
#ifndef SP_GENFUNC
#define SP_GENFUNC static
#endif


//--------------------------------------------------------------------------------
// const value
//--------------------------------------------------------------------------------

#ifndef SP_REAL
#define SP_REAL float
#endif

#define SP_CAST(V) static_cast<SP_REAL>(V)

// pi
#define SP_PI static_cast<SP_REAL>(3.14159265358979323846)

// limit value regarded as zero
#define SP_SMALL SP_CAST(1.0e-20)

// limit value regarded as infinity
#define SP_INFINITY SP_CAST(1.0e+20)

// maximal value (unsigned char)
#define SP_BYTEMAX 255

// maximal value (int)
#define SP_INTMAX ((int)(((unsigned)-1)/2))

// maximal string
#define SP_STRMAX 512

// maximal dimension
#define SP_DIMMAX 3


//--------------------------------------------------------------------------------
// once 
//--------------------------------------------------------------------------------

#define SP_ONCE(func) { static bool once = true; if(once){ once = false; func; } }


//--------------------------------------------------------------------------------
// shader
//--------------------------------------------------------------------------------

#define SP_SHADER(...)  #__VA_ARGS__



//--------------------------------------------------------------------------------
// base struct
//--------------------------------------------------------------------------------

namespace sp{

    //--------------------------------------------------------------------------------
    // type
    //--------------------------------------------------------------------------------
    
    typedef unsigned char Byte;


    //--------------------------------------------------------------------------------
    // complex
    //--------------------------------------------------------------------------------

    struct Cmp {
        SP_REAL re, im;
    };


    //--------------------------------------------------------------------------------
    // memory ptr
    //--------------------------------------------------------------------------------

    template<typename TYPE> struct ExPtr{
        // pointer
        TYPE *ptr;

        // dimension
        int dim;

        // dimension size
        int dsize[SP_DIMMAX];
    };

    //--------------------------------------------------------------------------------
    // rectangle
    //--------------------------------------------------------------------------------

    struct Rect2 {
        // dimension base
        int dbase[2];

        // dimension size
        int dsize[2];
    };

    struct Rect3 {
        // dimension base
        int dbase[3];

        // dimension size
        int dsize[3];
    };



    //--------------------------------------------------------------------------------
    // vector
    //--------------------------------------------------------------------------------

    struct Vec2{
        SP_REAL x, y;
    };

    struct Vec3{
        SP_REAL x, y, z;
    };


    //--------------------------------------------------------------------------------
    // position and normal
    //--------------------------------------------------------------------------------
    
    struct VecPN2{
        Vec2 pos, nrm;
    };

    struct VecPN3{
        Vec3 pos, nrm;
    };


    //--------------------------------------------------------------------------------
    // line
    //--------------------------------------------------------------------------------

    struct Line2 {
        Vec2 pos[2];
    };

    struct Line3 {
        Vec3 pos[2];
    };


    //--------------------------------------------------------------------------------
    // triangle mesh
    //--------------------------------------------------------------------------------
    
    struct Mesh2{
        Vec2 pos[3];
    };

    struct Mesh3 {
        Vec3 pos[3];
    };

    //--------------------------------------------------------------------------------
    // 3d transform
    //--------------------------------------------------------------------------------

    struct Rot{
        // quaternion
        SP_REAL qx, qy, qz, qw;
    };

    struct Pose{
        // rotation
        Rot rot;

        // translation
        Vec3 trn;
    };


    //--------------------------------------------------------------------------------
    // camera parameter
    //--------------------------------------------------------------------------------

    struct CamParam{
        int dsize[2];
        SP_REAL fx, fy;
        SP_REAL cx, cy;
        SP_REAL k1, k2, k3, p1, p2;
    };


    //--------------------------------------------------------------------------------
    // color
    //--------------------------------------------------------------------------------

    struct Col3{
        Byte r, g, b;
    };

    struct Col4 : public Col3 {
        Byte a;
    };


    //--------------------------------------------------------------------------------
    // byte order
    //--------------------------------------------------------------------------------
    
    enum ByteOrder {
        BigEndian,
        LittleEndian,
    };

}

#endif